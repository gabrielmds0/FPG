<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Formação em Paciente Grave - Liberdade Médica</title>
    <script src="https://trackings.nemu.com.br/trackings/OxVyKz8wj1/script.js" async data-tracking-id="OxVyKz8wj1" crossorigin="anonymous"></script>

    <script>
    var timer = setInterval(function () {
        var pixelPattern = /nemu_.{10}/;
    
        clearInterval(timer);
        var pixelTimer = setInterval(function () {
            if (pixelPattern.test(document.location.search)) {
                var params = new URLSearchParams(window.location.search);
                var utm_source = params.get("utm_source");
                var utm_campaign = params.get("utm_campaign");
                var utm_medium = params.get("utm_medium");
                var utm_content = params.get("utm_content");
                

                var inputTimer = setInterval(function () {
                    var inputUtmSource = document.querySelector("input#form-field-utm_source");
                    var inputUtmCampaign = document.querySelector("input#form-field-utm_campaign");
                    var inputUtmMedium = document.querySelector("input#form-field-utm_medium");
                    var inputUtmContent = document.querySelector("input#form-field-utm_content");

                    if (inputUtmSource) {
                        inputUtmSource.value = utm_source;
                        inputUtmCampaign.value = utm_campaign;
                        inputUtmMedium.value = utm_medium;
                        inputUtmContent.value = utm_content;
                        clearInterval(inputTimer);
                    }
                }, 100);
                clearInterval(pixelTimer);
            }
        }, 100);
    }, 100);
    </script>


<!-- Meta Pixel Code -->
<script>
!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '1064327147462690');
fbq('track', 'PageView');
</script>
  </head>
  <body>
    <script>
      // Função para pegar cookies
      function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) return parts.pop().split(';').shift();
        return null;
      }
    
      // Buscar IP e enviar dados para o n8n
      fetch("https://api64.ipify.org?format=json")
        .then(response => response.json())
        .then(data => {
          // Capturar UTMs da URL
          const urlParams = new URLSearchParams(window.location.search);
          
          const payload = {
            fbp: getCookie('_fbp') || null,
            fbc: getCookie('_fbc') || null,
            ua: navigator.userAgent,
            url: window.location.href,
            ip: data.ip,
            timestamp: Math.floor(Date.now() / 1000),
            utm_source: urlParams.get('utm_source'),
            utm_medium: urlParams.get('utm_medium'),
            utm_campaign: urlParams.get('utm_campaign'),
            utm_content: urlParams.get('utm_content'),
            utm_term: urlParams.get('utm_term')
          };
    
          // URL do webhook - use a Production URL do n8n
          fetch("https://projetolm-n8n.8x0hqh.easypanel.host/webhook/pageview", {
            method: "POST",
            headers: {
              "Content-Type": "application/json"
            },
            body: JSON.stringify(payload)
          })
          .then(() => console.log('PageView tracked successfully'))
          .catch(error => console.error('Error tracking pageview:', error));
        })
        .catch(error => console.error('Error getting IP:', error));
    </script>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
